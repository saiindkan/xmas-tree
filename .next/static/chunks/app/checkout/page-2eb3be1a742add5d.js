(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[285],{4267:function(e,s,t){Promise.resolve().then(t.bind(t,5063))},5063:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return m}});var r=t(7437),a=t(2265),l=t(9376),n=t(605),i=t(6059),d=t(4937),o=t(6853),c=t(257);let u=e=>{let{onSuccess:s}=e,t=(0,o.useStripe)(),l=(0,o.useElements)(),[n,i]=(0,a.useState)(null),[d,c]=(0,a.useState)(!1),u=async e=>{if(e.preventDefault(),t&&l){c(!0),i(null);try{let{error:e,paymentIntent:r}=await t.confirmPayment({elements:l,confirmParams:{return_url:"".concat(window.location.origin,"/order-confirmation")},redirect:"if_required"});if(e)throw e;r&&"succeeded"===r.status&&s()}catch(e){i(e instanceof Error?e.message:"An error occurred"),c(!1)}}};return(0,r.jsxs)("form",{onSubmit:u,className:"space-y-4",children:[(0,r.jsx)(o.PaymentElement,{}),n&&(0,r.jsx)("div",{className:"text-red-600 text-sm mt-2",children:n}),(0,r.jsx)("button",{type:"submit",disabled:!t||d,className:"w-full bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",children:d?"Processing...":"Pay Now"})]})};function m(){var e;let{cart:s,clearCart:t}=(0,i.j)(),m=(0,l.useRouter)(),{data:x}=(0,n.useSession)(),[h,p]=(0,a.useState)(!0),[g,f]=(0,a.useState)(!1),[y,j]=(0,a.useState)(!1),[v,b]=(0,a.useState)(!0),[N,w]=(0,a.useState)(null),[C,S]=(0,a.useState)(""),k=s.reduce((e,s)=>e+s.price*s.quantity,0),F=k>=50?0:5.99,q=.08*k,[P,E]=(0,a.useState)({firstName:"",lastName:"",email:(null==x?void 0:null===(e=x.user)||void 0===e?void 0:e.email)||"",phone:"",address1:"",address2:"",city:"",state:"",postalCode:"",country:"United States"});return((0,a.useEffect)(()=>{{let e="https:"===window.location.protocol,t="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname;b(e||t),w((0,d.loadStripe)(c.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY||""));let r=async()=>{try{let e=await fetch("/api/create-payment-intent",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:s})});if(!e.ok)throw Error("Failed to create payment intent");let t=await e.json();S(t.clientSecret)}catch(e){console.error("Error:",e)}finally{p(!1)}};s.length>0?r():p(!1)}},[s]),h)?(0,r.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600 mx-auto"}),(0,r.jsx)("p",{className:"mt-4",children:"Loading checkout..."})]})}):0!==s.length||y?y?(0,r.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,r.jsx)("div",{className:"bg-green-50 border-l-4 border-green-400 p-4",children:(0,r.jsxs)("div",{className:"flex",children:[(0,r.jsx)("div",{className:"flex-shrink-0",children:(0,r.jsx)("svg",{className:"h-5 w-5 text-green-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}),(0,r.jsx)("div",{className:"ml-3",children:(0,r.jsxs)("p",{className:"text-sm text-green-700",children:["Thank you for your order! A confirmation email has been sent to ",P.email,"."]})})]})}),(0,r.jsx)("div",{className:"mt-6 text-center",children:(0,r.jsx)("button",{onClick:()=>m.push("/"),className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2",children:"Return to Home"})})]}):(0,r.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold mb-6",children:"Checkout"}),!v&&(0,r.jsx)("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6",children:(0,r.jsxs)("div",{className:"flex",children:[(0,r.jsx)("div",{className:"flex-shrink-0",children:(0,r.jsx)("svg",{className:"h-5 w-5 text-yellow-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),(0,r.jsx)("div",{className:"ml-3",children:(0,r.jsx)("p",{className:"text-sm text-yellow-700",children:"For security reasons, please ensure you're using HTTPS in production."})})]})}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[(0,r.jsxs)("div",{className:"md:col-span-2 space-y-6",children:[(0,r.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Contact Information"}),(0,r.jsx)("div",{className:"space-y-4",children:(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email address"}),(0,r.jsx)("input",{type:"email",id:"email",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500",value:P.email,onChange:e=>E({...P,email:e.target.value}),required:!0})]})})]}),(0,r.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Billing Address"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"firstName",className:"block text-sm font-medium text-gray-700 mb-1",children:"First name"}),(0,r.jsx)("input",{type:"text",id:"firstName",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500",value:P.firstName,onChange:e=>E({...P,firstName:e.target.value}),required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"lastName",className:"block text-sm font-medium text-gray-700 mb-1",children:"Last name"}),(0,r.jsx)("input",{type:"text",id:"lastName",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500",value:P.lastName,onChange:e=>E({...P,lastName:e.target.value}),required:!0})]})]}),(0,r.jsxs)("div",{className:"mt-4",children:[(0,r.jsx)("label",{htmlFor:"address1",className:"block text-sm font-medium text-gray-700 mb-1",children:"Address"}),(0,r.jsx)("input",{type:"text",id:"address1",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 mb-2",value:P.address1,onChange:e=>E({...P,address1:e.target.value}),placeholder:"Street address",required:!0}),(0,r.jsx)("input",{type:"text",id:"address2",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500",value:P.address2,onChange:e=>E({...P,address2:e.target.value}),placeholder:"Apartment, suite, etc. (optional)"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"city",className:"block text-sm font-medium text-gray-700 mb-1",children:"City"}),(0,r.jsx)("input",{type:"text",id:"city",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500",value:P.city,onChange:e=>E({...P,city:e.target.value}),required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"state",className:"block text-sm font-medium text-gray-700 mb-1",children:"State/Province"}),(0,r.jsx)("input",{type:"text",id:"state",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500",value:P.state,onChange:e=>E({...P,state:e.target.value}),required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"postalCode",className:"block text-sm font-medium text-gray-700 mb-1",children:"ZIP/Postal code"}),(0,r.jsx)("input",{type:"text",id:"postalCode",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500",value:P.postalCode,onChange:e=>E({...P,postalCode:e.target.value}),required:!0})]})]}),(0,r.jsxs)("div",{className:"mt-4",children:[(0,r.jsx)("label",{htmlFor:"country",className:"block text-sm font-medium text-gray-700 mb-1",children:"Country/Region"}),(0,r.jsxs)("select",{id:"country",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500",value:P.country,onChange:e=>E({...P,country:e.target.value}),required:!0,children:[(0,r.jsx)("option",{value:"United States",children:"United States"}),(0,r.jsx)("option",{value:"Canada",children:"Canada"}),(0,r.jsx)("option",{value:"United Kingdom",children:"United Kingdom"}),(0,r.jsx)("option",{value:"Australia",children:"Australia"}),(0,r.jsx)("option",{value:"Other",children:"Other"})]})]}),(0,r.jsxs)("div",{className:"mt-4",children:[(0,r.jsx)("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone"}),(0,r.jsx)("input",{type:"tel",id:"phone",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500",value:P.phone,onChange:e=>E({...P,phone:e.target.value}),required:!0}),(0,r.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"For delivery updates and order notifications"})]})]}),(0,r.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Payment"}),(0,r.jsx)("div",{className:"bg-gray-50 p-4 rounded-md",children:C&&N?(0,r.jsx)(o.Elements,{stripe:N,options:{clientSecret:C},children:(0,r.jsx)(u,{onSuccess:()=>{j(!0),t()}})}):(0,r.jsx)("div",{className:"text-center py-8",children:(0,r.jsxs)("div",{className:"animate-pulse space-y-4",children:[(0,r.jsx)("div",{className:"h-4 bg-gray-200 rounded w-3/4 mx-auto"}),(0,r.jsx)("div",{className:"h-12 bg-gray-200 rounded"}),(0,r.jsx)("div",{className:"h-8 bg-gray-200 rounded w-1/2 mx-auto"})]})})})]})]}),(0,r.jsx)("div",{children:(0,r.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow sticky top-4",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Order Summary"}),(0,r.jsxs)("div",{className:"space-y-4",children:[s.map(e=>(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium",children:e.name}),(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:["Qty: ",e.quantity]})]}),(0,r.jsxs)("p",{className:"font-medium",children:["$",(e.price*e.quantity).toFixed(2)]})]},e.id)),(0,r.jsxs)("div",{className:"border-t pt-4 mt-4 space-y-2",children:[(0,r.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,r.jsx)("span",{children:"Subtotal"}),(0,r.jsxs)("span",{children:["$",s.reduce((e,s)=>e+s.price*s.quantity,0).toFixed(2)]})]}),(0,r.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,r.jsx)("span",{children:"Shipping"}),(0,r.jsxs)("span",{children:[0===F?"Free":"$".concat(F.toFixed(2)),k<50&&k>0&&(0,r.jsx)("span",{className:"text-xs text-green-600 ml-1",children:k>0&&"(Spend $".concat((50-k).toFixed(2)," more for free shipping!)")})]})]}),(0,r.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,r.jsx)("span",{children:"Tax"}),(0,r.jsxs)("span",{children:["$",q.toFixed(2)]})]}),(0,r.jsxs)("div",{className:"flex justify-between font-medium pt-2 border-t mt-2",children:[(0,r.jsx)("span",{children:"Total"}),(0,r.jsxs)("span",{children:["$",(k+F+q).toFixed(2)]})]})]})]})]})})]})]}):(0,r.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,r.jsx)("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-4",children:(0,r.jsxs)("div",{className:"flex",children:[(0,r.jsx)("div",{className:"flex-shrink-0",children:(0,r.jsx)("svg",{className:"h-5 w-5 text-yellow-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),(0,r.jsx)("div",{className:"ml-3",children:(0,r.jsx)("p",{className:"text-sm text-yellow-700",children:"We're sorry, but we can't process your payment at this time. Please add items to your cart before checking out."})})]})}),(0,r.jsx)("div",{className:"mt-6 text-center",children:(0,r.jsx)("button",{onClick:()=>m.push("/products"),className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2",children:"Continue Shopping"})})]})}},6059:function(e,s,t){"use strict";t.d(s,{Z:function(){return i},j:function(){return d}});var r=t(7437),a=t(2265);let l=(0,a.createContext)(void 0),n="xmas_tree_shop_cart";function i(e){let{children:s}=e,[t,i]=(0,a.useState)([]),[d,o]=(0,a.useState)(!0);(0,a.useEffect)(()=>{try{let e=localStorage.getItem(n);e&&i(JSON.parse(e))}catch(e){console.error("Failed to load cart from storage",e)}finally{o(!1)}},[]),(0,a.useEffect)(()=>{try{localStorage.setItem(n,JSON.stringify(t))}catch(e){console.error("Failed to save cart to storage",e)}},[t]);let c=(0,a.useCallback)(function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;i(t=>t.find(s=>s.id===e.id)?t.map(t=>t.id===e.id?{...t,quantity:t.quantity+s}:t):[...t,{...e,quantity:s}])},[]),u=(0,a.useCallback)(e=>{i(s=>s.filter(s=>s.id!==e))},[]),m=(0,a.useCallback)((e,s)=>{if(s<=0){u(e);return}i(t=>t.map(t=>t.id===e?{...t,quantity:s}:t))},[u]),x=(0,a.useCallback)(()=>{i([])},[]),h=(0,a.useCallback)(e=>{var s;return(null===(s=t.find(s=>s.id===e))||void 0===s?void 0:s.quantity)||0},[t]),p=(0,a.useCallback)(()=>t.reduce((e,s)=>e+s.price*s.quantity,0),[t]),g=(0,a.useCallback)(()=>t.reduce((e,s)=>e+s.quantity,0),[t]);return(0,r.jsx)(l.Provider,{value:{cart:t,addToCart:c,removeFromCart:u,updateQuantity:m,clearCart:x,getItemQuantity:h,getCartTotal:p,getCartItemCount:g},children:s})}function d(){let e=(0,a.useContext)(l);if(void 0===e)throw Error("useCart must be used within a CartProvider");return e}}},function(e){e.O(0,[605,486,971,117,744],function(){return e(e.s=4267)}),_N_E=e.O()}]);