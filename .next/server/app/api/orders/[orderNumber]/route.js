"use strict";(()=>{var e={};e.id=982,e.ids=[982],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},61282:e=>{e.exports=require("child_process")},84770:e=>{e.exports=require("crypto")},80665:e=>{e.exports=require("dns")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},98216:e=>{e.exports=require("net")},19801:e=>{e.exports=require("os")},55315:e=>{e.exports=require("path")},68621:e=>{e.exports=require("punycode")},86624:e=>{e.exports=require("querystring")},76162:e=>{e.exports=require("stream")},82452:e=>{e.exports=require("tls")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},60150:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>x,patchFetch:()=>f,requestAsyncStorage:()=>m,routeModule:()=>p,serverHooks:()=>h,staticGenerationAsyncStorage:()=>g});var s={};t.r(s),t.d(s,{GET:()=>d});var o=t(49303),i=t(88716),a=t(60670),n=t(87070),l=t(45609),u=t(95456),c=t(1926);async function d(e,{params:r}){try{let e=await (0,l.getServerSession)(u.L);if(!e?.user?.id)return n.NextResponse.json({error:"Authentication required"},{status:401});let t=e.user.id,{data:s,error:o}=await c.pR.from("orders").select(`
        *,
        order_items (*),
        users (name, email)
      `).eq("order_number",r.orderNumber).eq("user_id",t).single();if(o&&"PGRST116"!==o.code)throw console.error("[Orders] Error fetching order:",o),o;if(!s)return n.NextResponse.json({error:"Order not found"},{status:404});return n.NextResponse.json({success:!0,order:s})}catch(e){return console.error("[Orders] Error fetching order:",e),n.NextResponse.json({error:"Failed to fetch order"},{status:500})}}let p=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/orders/[orderNumber]/route",pathname:"/api/orders/[orderNumber]",filename:"route",bundlePath:"app/api/orders/[orderNumber]/route"},resolvedPagePath:"/Users/anonymous/Downloads/xmas-tree/src/app/api/orders/[orderNumber]/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:g,serverHooks:h}=p,x="/api/orders/[orderNumber]/route";function f(){return(0,a.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:g})}},95456:(e,r,t)=>{t.d(r,{L:()=>a});var s=t(53797),o=t(1926),i=t(20471);let a={providers:[(0,s.Z)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(console.log("[NextAuth] Authorize called with:",{email:e?.email,passwordProvided:!!e?.password}),!e?.email||!e?.password)throw console.log("[NextAuth] Missing credentials"),Error("Email and password are required");let r=e.email,t=e.password;try{console.log("[NextAuth] Looking up user:",r);let e=(0,o.uw)(),{data:s,error:i}=await e.auth.signInWithPassword({email:r,password:t});if(i||!s.user)throw console.log("[NextAuth] Supabase sign-in error:",i?.message),Error(i?.message||"Invalid login credentials");let a=s.user;console.log("[NextAuth] Authentication successful for:",r);let{data:n}=await e.from("users").select("id").eq("id",a.id).single();if(!n){console.log("[NextAuth] Public profile not found. Creating one for:",a.email);let{error:r}=await e.from("users").insert({id:a.id,name:a.user_metadata.name||a.email,email:a.email});if(r)throw console.error("[NextAuth] Error creating public profile for credential user:",r),Error("Failed to create user profile after login.")}return{id:a.id,email:a.email,name:a.user_metadata.name||null,image:a.user_metadata.picture||null}}catch(e){throw console.error("[NextAuth] Authorization error:",e),e}}})],session:{strategy:"jwt",maxAge:86400},pages:{signIn:"/auth/signin",error:"/auth/error"},events:{async signIn({user:e}){if(e.email)try{let r=new Date().toLocaleString(),t=`Hello ${e.name||"Valued Customer"},

We noticed a successful login to your Indkan Christmas Tree Store account.

Details of this login:
- Time: ${r}

Best regards,
The Indkan Christmas Tree Store Security Team`,s=`
            <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; color: #333;">
              <h2 style="color: #2e7d32;">ðŸ”’ Successful Login Detected</h2>
              
              <p>Hello ${e.name||"Valued Customer"},</p>
              
              <p>We noticed a successful login to your Indkan Christmas Tree Store account.</p>

              <div style="background-color: #f5f5f5; padding: 15px; border-radius: 5px; margin: 20px 0; border-left: 4px solid #2e7d32;">
                <h3 style="margin-top: 0; color: #2e7d32;">Login Details</h3>
                <p><strong>Time:</strong> ${r}</p>
              </div>
              
              
              <p style="color: #666; font-size: 0.9em;">For security reasons, this is an automated message. Please do not reply to this email.</p>
              
              <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee; font-size: 12px; color: #777;">
                <p>\xa9 ${new Date().getFullYear()} Indkan Christmas Tree Store. All rights reserved.</p>
                <p>This email was sent to ${e.email} as part of our security notifications.</p>
              </div>
            </div>
          `;await (0,i.C)({to:e.email,subject:"\uD83D\uDD12 Successful Login to Indkan Christmas Tree Store Account",text:t,html:s})}catch(e){console.error("Failed to send login email:",e)}}},callbacks:{jwt:async({token:e,user:r})=>(r&&(e.id=r.id),e),session:async({session:e,token:r})=>(r&&(e.user.id=r.id),e),redirect:async({url:e,baseUrl:r})=>e.startsWith("/")?`${r}${e}`:new URL(e).origin===r?e:r,signIn:async({user:e,account:r})=>(console.log("[NextAuth] SignIn callback called",{user:e?.email,account:r?.provider}),!0)},secret:process.env.NEXTAUTH_SECRET,debug:!1}},20471:(e,r,t)=>{t.d(r,{C:()=>o});let s=t(55245).createTransport({host:process.env.SMTP_HOST,port:Number(process.env.SMTP_PORT),secure:"true"===process.env.SMTP_SECURE,auth:{user:process.env.SMTP_USER,pass:process.env.SMTP_PASS}});async function o({to:e,subject:r,text:t,html:o}){let i={from:`"Indkan Christmas Tree Store" <${process.env.SMTP_USER}>`,to:e,subject:r,text:t,html:o};try{let e=await s.sendMail(i);return console.log("Message sent: %s",e.messageId),e}catch(e){throw console.error("Error sending email:",e),Error("Failed to send email.")}}},1926:(e,r,t)=>{t.d(r,{fU:()=>l,pR:()=>c,uw:()=>u});var s=t(86718),o=t(71615);let i="https://nyykggssyasvxrtjhhhb.supabase.co",a="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im55eWtnZ3NzeWFzdnhydGpoaGhiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUwMjM5NDksImV4cCI6MjA3MDU5OTk0OX0.60hkCLL76yg0Bg9-W-le06lHnSwadeU74-xEpRPAqug",n=process.env.SUPABASE_SERVICE_ROLE_KEY;function l(){let e=(0,o.cookies)();return(0,s.createServerClient)(i,a,{cookies:{get:r=>e.get(r)?.value}})}function u(){let e=(0,o.cookies)();return(0,s.createServerClient)(i,n,{cookies:{get:r=>e.get(r)?.value}})}(0,s.createBrowserClient)(i,a);let c=(0,s.createServerClient)(i,n,{cookies:{get:()=>""}})}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[276,219,70,245,857],()=>t(60150));module.exports=s})();